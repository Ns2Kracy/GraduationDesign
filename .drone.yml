kind: pipeline
type: exec
name: web

platform:
  os: windows
  arch: amd64

trigger:
  branch:
    include:
      - main
      - dev
    event:
      - push
      - pull_request

steps:
  - name: format
    commands:
      - cd apps/web
      - pnpm install
      - pnpm run format
  - name: lint
    commands:
      - cd apps/web
      - pnpm run lint
      - pnpm run lint:fix
  - name: build
    commands:
      - cd apps/web
      - pnpm run build

---
kind: pipeline
type: exec
name: server

platform:
  os: windows
  arch: amd64

steps:
  - name: clippy
    environment:
      RUSTUP_DIST_SERVER: https://rsproxy.cn
    commands:
      - cargo clippy -- -D warnings
      - cargo clippy --all-targets --all-features -- -D
      - cargo clippy --fix
  - name: fmt
    environment:
      RUSTUP_DIST_SERVER: https://rsproxy.cn
    commands:
      - cargo fmt --all -- --check
      - cargo fmt --all
  - name: build
    environment:
      RUSTUP_DIST_SERVER: https://rsproxy.cn
    commands:
      - cargo build --release
